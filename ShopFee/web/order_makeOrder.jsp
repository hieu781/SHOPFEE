<%-- 
    Document   : order_makeOrder
    Created on : Oct 5, 2023
    Author     : PhiNX
--%>

<%@page contentType="text/html" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<!DOCTYPE html>
<html lang="en">

    <head>
        <title>Make Order</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- Google Font -->
        <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;900&display=swap" rel="stylesheet">

        <!-- Css Styles -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" 
              integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <link rel="stylesheet" href="css/font-awesome.min.css" type="text/css">
        <link rel="stylesheet" href="css/elegant-icons.css" type="text/css">
        <link rel="stylesheet" href="css/nice-select.css" type="text/css">
        <link rel="stylesheet" href="css/jquery-ui.min.css" type="text/css">
        <link rel="stylesheet" href="css/owl.carousel.min.css" type="text/css">
        <link rel="stylesheet" href="css/slicknav.min.css" type="text/css">
        <link rel="stylesheet" href="css/style.css" type="text/css">
        <style>
            .shoping__discount input {
                width: 255px;
                height: 46px;
                border: 1px solid #cccccc;
                font-size: 16px;
                text-align: left;
                display: inline-block;
                margin-right: 15px;
            }
            .error-message{
                margin-top: 10px;
                color:#721c24;
                background-color:#f8d7da;
                border-color:#f5c6cb
            }
        </style>
    </head>

    <body>
        <!-- Header Section Begin -->
        <jsp:include page="header.jsp"></jsp:include>
            <!-- Header Section End -->

            <!-- Breadcrumb Section Begin -->
            <section class="breadcrumb-section set-bg" style="padding: 0px">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12 text-center">
                            <h1><b>Make Order</b></h1>
                        </div>
                    </div>
                </div>
            </section>
            <!-- Breadcrumb Section End -->

            <!-- Shoping Cart Section Begin -->
            <section class="shoping-cart spad" style="padding: 50px">
                <div class="container">
                    <form action="checkout" method="post" id="checkout">
                        <div class="row">
                            <div class="col-lg-12">                            
                                <div class="shoping__cart__table">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th class="shoping__product">Products</th>
                                                <th colspan="2">Price</th>
                                                <th>Quantity</th>
                                                <th colspan="2">Total</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        <c:set var="total" value="0" /> 
                                        <c:choose>
                                            <c:when test="${empty cart_list}">
                                                <tr>
                                                    <td colspan="5" style="color: red">You have no order</td>
                                                </tr>
                                            </c:when>
                                            <c:otherwise>
                                                <c:forEach items="${cart_list}" var="c">      
                                                    <tr>
                                                        <td class="shoping__cart__item">
                                                            <img style="height: 150px" src="img/laptop/${c.getBrand()}/${c.getImage()}" alt="${o.getModel()}">
                                                            <h6>${c.getProduct_name()}</h6>
                                                        </td>
                                                        <fmt:formatNumber value="${c.getPrice()}" pattern="#,##0.##" var="origin_Price" />
                                                        <c:choose>
                                                            <c:when test="${c.getDiscount() != 0}">
                                                                <td colspan="2" class="shoping__cart__price product__discount__item__text">
                                                                    <!--View Price have Discount Event and not -->
                                                                    <fmt:formatNumber value="${c.getPrice() - c.getPrice() * c.getDiscount()}" pattern="#,##0.##" var="discount_Price" />                                    
                                                                    <div class="product__item__price">${discount_Price} VND <br><span>${origin_Price} VND</span></div>
                                                                </td>
                                                                <td class="shoping__cart__quantity">
                                                                    <div class="quantity">
                                                                        <div class="pro-qty">
                                                                            <input type="text" value="${c.getQuantity()}">
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td colspan="2" class="shoping__cart__total">
                                                                    <fmt:formatNumber value="${(c.getPrice() - c.getPrice() * c.getDiscount()) * c.getQuantity()}" pattern="#,##0.##" var="total_Price" />
                                                                    ${total_Price} VND
                                                                    <c:set var="total" value="${total + ((c.getPrice() - c.getPrice() * c.getDiscount()) * c.getQuantity())}" />
                                                                </td>
                                                            </c:when>
                                                            <c:otherwise>
                                                                <td colspan="2" class="shoping__cart__price">
                                                                    <!--View Price does not have Discount Event -->
                                                                    <div class="product__item__price">${origin_Price} VND <br><span></span></div>

                                                                </td>
                                                                <td class="shoping__cart__quantity">
                                                                    <div class="quantity">
                                                                        <div class="pro-qty">
                                                                            <input type="text" value="${c.getQuantity()}">
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                                <td colspan="2" class="shoping__cart__total">
                                                                    <fmt:formatNumber value="${c.getPrice() * c.getQuantity()}" pattern="#,##0.##" var="total_Price" />
                                                                    ${total_Price} VND
                                                                    <c:set var="total" value="${total + (c.getPrice() * c.getQuantity())}" />
                                                                </td>
                                                            </c:otherwise>
                                                        </c:choose>
                                                    </tr>
                                                </c:forEach>
                                            </c:otherwise>
                                        </c:choose>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="shoping__checkout">
                                <div class="table-responsive">
                                    <table class="table table-borderless">
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <input required type="text" class="form-control" name="name" id="name" placeholder="TÃªn">
                                                    <span id="nameError" class="error-message"></span>
                                                </td>                                        
                                                <td>
                                                    <input required type="text" class="form-control" name="phonenumber" id="phonenumber" placeholder="Sá» Äiá»n thoáº¡i">
                                                    <span id="phoneError" class="error-message"></span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <select required class="form-control" name="city" id="city">
                                                        <option value="" selected>Chá»n tá»nh thÃ nh</option>
                                                        <option value="ThÃ nh phá» HÃ  Ná»i">ThÃ nh phá» HÃ  Ná»i</option>
                                                        <option value="ThÃ nh phá» Háº£i PhÃ²ng">ThÃ nh phá» Háº£i PhÃ²ng</option>
                                                        <option value="Tá»nh HÆ°ng YÃªn">Tá»nh HÆ°ng YÃªn</option>
                                                        <option value="Tá»nh Háº£i DÆ°Æ¡ng">Tá»nh Háº£i DÆ°Æ¡ng</option>
                                                        <option value="Tá»nh Nam Äá»nh">Tá»nh Nam Äá»nh</option>
                                                        <option value="Tá»nh Báº¯c Ninh">Tá»nh Báº¯c Ninh</option>
                                                        <option value="Tá»nh VÄ©nh PhÃºc">Tá»nh VÄ©nh PhÃºc</option>
                                                        <option value="Tá»nh PhÃº Thá»">Tá»nh PhÃº Thá»</option>
                                                        <option value="Tá»nh HÃ  Nam">Tá»nh HÃ  Nam</option>
                                                        <option value="Tá»nh HÃ  Giang">Tá»nh HÃ  Giang</option>
                                                        <option value="Tá»nh ThÃ¡i NguyÃªn">Tá»nh ThÃ¡i NguyÃªn</option>
                                                        <option value="Tá»nh YÃªn BÃ¡i">Tá»nh YÃªn BÃ¡i</option>
                                                        <option value="Tá»nh LÃ o Cai">Tá»nh LÃ o Cai</option>
                                                        <option value="Tá»nh TuyÃªn Quang">Tá»nh TuyÃªn Quang</option>
                                                        <option value="Tá»nh Láº¡ng SÆ¡n">Tá»nh Láº¡ng SÆ¡n</option>
                                                        <option value="Tá»nh Lai ChÃ¢u">Tá»nh Lai ChÃ¢u</option>
                                                        <option value="Tá»nh Cao Báº±ng">Tá»nh Cao Báº±ng</option>
                                                        <option value="Tá»nh HoÃ  BÃ¬nh">Tá»nh HoÃ  BÃ¬nh</option>
                                                        <option value="Tá»nh Ninh BÃ¬nh">Tá»nh Ninh BÃ¬nh</option>
                                                        <option value="Tá»nh Thanh HÃ³a">Tá»nh Thanh HÃ³a</option>
                                                        <option value="Tá»nh Nghá» An">Tá»nh Nghá» An</option>
                                                        <option value="Tá»nh HÃ  TÄ©nh">Tá»nh HÃ  TÄ©nh</option>
                                                        <option value="Tá»nh Quáº£ng BÃ¬nh">Tá»nh Quáº£ng BÃ¬nh</option>
                                                        <option value="Tá»nh Quáº£ng Trá»">Tá»nh Quáº£ng Trá»</option>
                                                        <option value="Tá»nh Thá»«a ThiÃªn-Huáº¿">Tá»nh Thá»«a ThiÃªn-Huáº¿</option>
                                                        <option value="ThÃ nh phá» ÄÃ  Náºµng">ThÃ nh phá» ÄÃ  Náºµng</option>
                                                        <option value="Tá»nh Quáº£ng Nam">Tá»nh Quáº£ng Nam</option>
                                                        <option value="Tá»nh Quáº£ng NgÃ£i">Tá»nh Quáº£ng NgÃ£i</option>
                                                        <option value="Tá»nh BÃ¬nh Äá»nh">Tá»nh BÃ¬nh Äá»nh</option>
                                                        <option value="Tá»nh PhÃº YÃªn">Tá»nh PhÃº YÃªn</option>
                                                        <option value="Tá»nh KhÃ¡nh HÃ²a">Tá»nh KhÃ¡nh HÃ²a</option>
                                                        <option value="Tá»nh Ninh Thuáº­n">Tá»nh Ninh Thuáº­n</option>
                                                        <option value="Tá»nh BÃ¬nh Thuáº­n">Tá»nh BÃ¬nh Thuáº­n</option>
                                                        <option value="Tá»nh Kon Tum">Tá»nh Kon Tum</option>
                                                        <option value="Tá»nh Gia Lai">Tá»nh Gia Lai</option>
                                                        <option value="Tá»nh Äáº¯k Láº¯k">Tá»nh Äáº¯k Láº¯k</option>
                                                        <option value="Tá»nh Äáº¯k NÃ´ng">Tá»nh Äáº¯k NÃ´ng</option>
                                                        <option value="Tá»nh LÃ¢m Äá»ng">Tá»nh LÃ¢m Äá»ng</option>
                                                        <option value="Tá»nh BÃ¬nh PhÆ°á»c">Tá»nh BÃ¬nh PhÆ°á»c</option>
                                                        <option value="Tá»nh TÃ¢y Ninh">Tá»nh TÃ¢y Ninh</option>
                                                        <option value="Tá»nh BÃ¬nh DÆ°Æ¡ng">Tá»nh BÃ¬nh DÆ°Æ¡ng</option>
                                                        <option value="Tá»nh Äá»ng Nai">Tá»nh Äá»ng Nai</option>
                                                        <option value="Tá»nh BÃ  Rá»a-VÅ©ng TÃ u">Tá»nh BÃ  Rá»a-VÅ©ng TÃ u</option>
                                                        <option value="ThÃ nh phá» Há» ChÃ­ Minh">ThÃ nh phá» Há» ChÃ­ Minh</option>
                                                        <option value="Tá»nh Long An">Tá»nh Long An</option>
                                                        <option value="Tá»nh Tiá»n Giang">Tá»nh Tiá»n Giang</option>
                                                        <option value="Tá»nh Báº¿n Tre">Tá»nh Báº¿n Tre</option>
                                                        <option value="Tá»nh TrÃ  Vinh">Tá»nh TrÃ  Vinh</option>
                                                        <option value="Tá»nh VÄ©nh Long">Tá»nh VÄ©nh Long</option>
                                                        <option value="Tá»nh Äá»ng ThÃ¡p">Tá»nh Äá»ng ThÃ¡p</option>
                                                        <option value="Tá»nh An Giang">Tá»nh An Giang</option>
                                                        <option value="Tá»nh KiÃªn Giang">Tá»nh KiÃªn Giang</option>
                                                        <option value="Tá»nh CÃ  Mau">Tá»nh CÃ  Mau</option>
                                                        <option value="Tá»nh Háº­u Giang">Tá»nh Háº­u Giang</option>
                                                        <option value="Tá»nh SÃ³c TrÄng">Tá»nh SÃ³c TrÄng</option>
                                                        <option value="Tá»nh Báº¡c LiÃªu">Tá»nh Báº¡c LiÃªu</option>
                                                        <option value="ThÃ nh phá» Cáº§n ThÆ¡">ThÃ nh phá» Cáº§n ThÆ¡</option>
                                                    </select>
                                                </td>
                                                <td>
                                                    <select required class="mb-3 form-control" name="payment" id="payment">
                                                        <option value="" selected>Payment method</option>
                                                        <c:if test="${user_Data.getRole() == 1 || user_Data.getRole() == 3}">
                                                            <option value="In store">In store</option>                                                            
                                                        </c:if>
                                                        <option value="Cast">Ship COD</option>
                                                        <option value="VNPAY">VNPAY</option>
                                                    </select>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td colspan="2">
                                                    <input required type="text" class="form-control" name="address" id="address" placeholder="Äá»a chá»">
                                                    <span id="addressError" class="error-message"></span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td colspan="2">
                                                    <input type="text" class="form-control" name="note" id="note" placeholder="Ghi chÃº">
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>                         
                        </div>  
                        <div class="col-lg-6">
                            <div class="shoping__checkout">
                                <fmt:formatNumber value="${total}" pattern="#,##0.##" var="total_last" />
                                <h5>Order Total</h5>
                                <ul>
                                    <li>Subtotal <span>${total_last} VND</span></li>
                                    <li>Ship Fee <span id="shipping-fee-amount">0 VND</span></li>
                                    <li>Total <span id="total-shipping-fee-amount">${total_last} VND</span></li>
                                </ul>
                                <input type="hidden" name="city1" id="city1" value="">
                                <input type="hidden" name="total" id="total" value="${total}">
                                <input type="hidden" name="shipFee" id="shipFee" value="">
                                <input style="width: 500px" class="site-btn" type="submit" value="PROCEED TO CHECKOUT">
                            </div>
                        </div>
                    </div>
                </form>
                <!--                <div class="row">
                                    <div class="shoping__continue">
                                        <div class="shoping__discount">
                                            <h5>Discount Codes</h5>
                                            <form>
                                                <input type="text" id="code" placeholder="Enter your coupon code">
                                                <button type="submit" class="site-btn" onclick="updateShippingFee()">APPLY COUPON</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>-->
            </div>
        </section>
        <!-- Shoping Cart Section End -->

        <!-- Footer Section Begin -->
        <jsp:include page="footer.jsp"></jsp:include>
        <!-- Footer Section End -->

        Js Plugins 
        <script>
            const citis = document.getElementById("city");

            const shippingFees = {
                "ThÃ nh phá» HÃ  Ná»i": 0,
                "ThÃ nh phá» Háº£i PhÃ²ng": 1,
                "Tá»nh HÆ°ng YÃªn": 1,
                "Tá»nh Háº£i DÆ°Æ¡ng": 1,
                "Tá»nh Nam Äá»nh": 1,
                "Tá»nh Báº¯c Ninh": 1,
                "Tá»nh VÄ©nh PhÃºc": 1,
                "Tá»nh PhÃº Thá»": 1,
                "Tá»nh HÃ  Nam": 1,
                "Tá»nh HÃ  Giang": 1,
                "Tá»nh ThÃ¡i NguyÃªn": 1,
                "Tá»nh YÃªn BÃ¡i": 1,
                "Tá»nh LÃ o Cai": 1,
                "Tá»nh TuyÃªn Quang": 1,
                "Tá»nh Láº¡ng SÆ¡n": 1,
                "Tá»nh Lai ChÃ¢u": 1,
                "Tá»nh Cao Báº±ng": 1,
                "Tá»nh HoÃ  BÃ¬nh": 1,
                "Tá»nh Ninh BÃ¬nh": 2,
                "Tá»nh Thanh HÃ³a": 2,
                "Tá»nh Nghá» An": 2,
                "Tá»nh HÃ  TÄ©nh": 2,
                "Tá»nh Quáº£ng BÃ¬nh": 2,
                "Tá»nh Quáº£ng Trá»": 2,
                "Tá»nh Thá»«a ThiÃªn-Huáº¿": 2,
                "ThÃ nh phá» ÄÃ  Náºµng": 2,
                "Tá»nh Quáº£ng Nam": 2,
                "Tá»nh Quáº£ng NgÃ£i": 2,
                "Tá»nh BÃ¬nh Äá»nh": 2,
                "Tá»nh PhÃº YÃªn": 2,
                "Tá»nh KhÃ¡nh HÃ²a": 2,
                "Tá»nh Ninh Thuáº­n": 2,
                "Tá»nh BÃ¬nh Thuáº­n": 2,
                "Tá»nh Kon Tum": 3,
                "Tá»nh Gia Lai": 3,
                "Tá»nh Äáº¯k Láº¯k": 3,
                "Tá»nh Äáº¯k NÃ´ng": 3,
                "Tá»nh LÃ¢m Äá»ng": 3,
                "Tá»nh BÃ¬nh PhÆ°á»c": 3,
                "Tá»nh TÃ¢y Ninh": 3,
                "Tá»nh BÃ¬nh DÆ°Æ¡ng": 3,
                "Tá»nh Äá»ng Nai": 3,
                "Tá»nh BÃ  Rá»a-VÅ©ng TÃ u": 3,
                "ThÃ nh phá» Há» ChÃ­ Minh": 3,
                "Tá»nh Long An": 3,
                "Tá»nh Tiá»n Giang": 3,
                "Tá»nh Báº¿n Tre": 4,
                "Tá»nh TrÃ  Vinh": 4,
                "Tá»nh VÄ©nh Long": 4,
                "Tá»nh Äá»ng ThÃ¡p": 4,
                "Tá»nh An Giang": 4,
                "Tá»nh KiÃªn Giang": 4,
                "Tá»nh CÃ  Mau": 4,
                "Tá»nh Háº­u Giang": 4,
                "Tá»nh SÃ³c TrÄng": 4,
                "Tá»nh Báº¡c LiÃªu": 4,
                "Tá»nh Cáº§n ThÆ¡": 4,
                "ThÃ nh phá» Cáº§n ThÆ¡": 4
            };

            function updateShippingFee() {
                const selectedCity = citis.options[citis.selectedIndex].text;
                const shipIndex = shippingFees[selectedCity] || 0;

                const shipFee = shipIndex * 20000;
                const formattedShipFee = shipFee.toLocaleString('vi-VN');
                document.getElementById("shipping-fee-amount").textContent = formattedShipFee + " VND";
                document.getElementById("shipFee").value = shipFee;

                const totalShipFee = parseFloat(document.getElementById("total").value) + shipFee;
                const formattedTotalShipFee = totalShipFee.toLocaleString('vi-VN');
                document.getElementById("total-shipping-fee-amount").textContent = formattedTotalShipFee + " VND";

                document.getElementById("city1").value = selectedCity;
            }

            citis.addEventListener("change", updateShippingFee);

//            document.getElementById("checkout").addEventListener("submit", function (event) {
//                event.preventDefault(); // Preveant form submission
//
//                const name = document.getElementsById("name")[0].value;
//                const phonenumber = document.getElementsById("phonenumber")[0].value;
//                const address = document.getElementsById("address")[0].value;
//
//                const validName = /^(?!^\s*$)[\w\s]+$/;
//                const validPhone = /^0\d{9,11}$/;
//                const validAddress = /^(?!^\s*$)[\w\s\-().,\\/]+$/;
//
//                if (!validName.test(name)) {
//                    nameError.textContent = "Name cannot just contain space and contain speacial characters.";
//                    nameError.style.display = "block";
//                } else {
//                    nameError.style.display = "none";
//                    nameError.textContent = "";
//                }
//
//                if (!validName.test(phonenumber)) {
//                    phoneError.textContent = "Phone number is invalid.";
//                    phoneError.style.display = "block";
//                } else {
//                    phoneError.style.display = "none";
//                    phoneError.textContent = "";
//                }
//
//                if (!validName.test(address)) {
//                    addressError.textContent = "Address is invalid.";
//                    addressError.style.display = "block";
//                } else {
//                    addressError.style.display = "none";
//                    addressError.textContent = "";
//                }
//
//                // Check if any errors were displayed
//                const errorMessages = document.querySelectorAll('.error-message');
//                let hasErrors = false;
//                errorMessages.forEach(function (message) {
//                    if (message.style.display === "block") {
//                        hasErrors = true;
//                    }
//                });
//
//                if (!hasErrors) {
//                    this.submit();
//                }
//            });

        </script>

    </body>

</html>
